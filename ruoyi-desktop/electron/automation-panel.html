<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‡ªåŠ¨åŒ–ä»»åŠ¡æ§åˆ¶å°</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f0f2f5;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 30px;
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 500;
    }
    
    .header .subtitle {
      opacity: 0.9;
      margin-top: 5px;
    }
    
    .content {
      padding: 30px;
    }
    
    .section {
      margin-bottom: 30px;
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      padding: 20px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
      border-bottom: 1px solid #f0f0f0;
      padding-bottom: 10px;
    }
    
    .config-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
    }
    
    .form-control {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #40a9ff;
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .checkbox-group label {
      margin-bottom: 0;
      cursor: pointer;
    }
    
    .btn {
      padding: 8px 20px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn-primary {
      background: #1890ff;
      color: white;
    }
    
    .btn-primary:hover {
      background: #40a9ff;
    }
    
    .btn-success {
      background: #52c41a;
      color: white;
    }
    
    .btn-success:hover {
      background: #73d13d;
    }
    
    .btn-danger {
      background: #f5222d;
      color: white;
    }
    
    .btn-danger:hover {
      background: #ff4d4f;
    }
    
    .btn-secondary {
      background: #f5f5f5;
      color: #333;
      border: 1px solid #d9d9d9;
    }
    
    .btn-secondary:hover {
      background: #e8e8e8;
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .status-panel {
      background: #fafafa;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .status-item:last-child {
      border-bottom: none;
    }
    
    .status-label {
      color: #666;
    }
    
    .status-value {
      font-weight: 500;
    }
    
    .status-running {
      color: #52c41a;
    }
    
    .status-stopped {
      color: #f5222d;
    }
    
    .logs-container {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.5;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid #333;
    }
    
    .log-entry:last-child {
      border-bottom: none;
    }
    
    .log-time {
      color: #6a9955;
      margin-right: 10px;
    }
    
    .log-level {
      font-weight: bold;
      margin-right: 10px;
    }
    
    .log-info { color: #569cd6; }
    .log-success { color: #6a9955; }
    .log-warning { color: #d7ba7d; }
    .log-error { color: #f44747; }
    
    .control-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .empty-logs {
      text-align: center;
      color: #888;
      padding: 20px;
    }
    
    .toggle-btn {
      background: none;
      border: none;
      color: #1890ff;
      cursor: pointer;
      font-size: 12px;
    }
    
    .advanced-config {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px dashed #e8e8e8;
    }
    
    .task-item {
      background: #fafafa;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      border-left: 3px solid #1890ff;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>è‡ªåŠ¨åŒ–ä»»åŠ¡æ§åˆ¶å°</h1>
      <div class="subtitle">ä½¿ç”¨ Electron å†…ç½®æµè§ˆå™¨è¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œ</div>
    </div>
    
    <div class="content">
      <!-- ä»»åŠ¡é…ç½® -->
      <div class="section">
        <div class="section-title">ä»»åŠ¡é…ç½®</div>
        <div class="config-grid">
          <div class="form-group">
            <label for="url">ç›®æ ‡URL</label>
            <input 
              type="text" 
              id="url" 
              class="form-control" 
              value="http://localhost:80"
              placeholder="è¯·è¾“å…¥ç›®æ ‡ç½‘å€"
            />
          </div>
          
          <div class="form-group">
            <label>è¿è¡Œæ¨¡å¼</label>
            <div class="checkbox-group">
              <input type="checkbox" id="headless" checked>
              <label for="headless">åå°è¿è¡Œï¼ˆæ— ç•Œé¢ï¼‰</label>
            </div>
          </div>
          
          <div class="form-group">
            <label>æ“ä½œé€‰é¡¹</label>
            <div class="checkbox-group">
              <input type="checkbox" id="screenshot" checked>
              <label for="screenshot">ä¿å­˜æˆªå›¾</label>
            </div>
          </div>
          
          <div class="form-group">
            <label>ä»»åŠ¡ç±»å‹</label>
            <select id="taskType" class="form-control">
              <option value="simple">ç®€å•æµ‹è¯•</option>
              <option value="custom">è‡ªå®šä¹‰ä»»åŠ¡</option>
              <option value="login">ç™»å½•æµ‹è¯•</option>
              <option value="data-entry">æ•°æ®å½•å…¥</option>
            </select>
          </div>
        </div>
        
        <!-- é«˜çº§é…ç½® -->
        <div class="advanced-config" id="advancedConfig" style="display: none;">
          <div class="section-title">é«˜çº§é…ç½®</div>
          <div class="config-grid">
            <div class="form-group">
              <label for="delay">é»˜è®¤å»¶è¿Ÿ(ms)</label>
              <input 
                type="number" 
                id="delay" 
                class="form-control" 
                value="1000"
                min="100"
                max="10000"
              />
            </div>
            
            <div class="form-group">
              <label for="timeout">è¶…æ—¶æ—¶é—´(ms)</label>
              <input 
                type="number" 
                id="timeout" 
                class="form-control" 
                value="30000"
                min="1000"
                max="120000"
              />
            </div>
          </div>
        </div>
        
        <button class="toggle-btn" onclick="toggleAdvanced()">
          æ˜¾ç¤ºé«˜çº§é…ç½®
        </button>
      </div>
      
        <!-- ä»»åŠ¡çŠ¶æ€ -->
        <div class="section">
            <div class="section-title">ä»»åŠ¡çŠ¶æ€</div>
            <div class="status-panel">
            <div class="status-item">
                <span class="status-label">è¿è¡ŒçŠ¶æ€:</span>
                <span id="runningStatus" class="status-value status-stopped">åœæ­¢</span>
            </div>
            <div class="status-item">
                <span class="status-label">æµè§ˆå™¨çŠ¶æ€:</span>
                <span id="browserStatus" class="status-value">æœªå¯åŠ¨</span>
            </div>
            <div class="status-item">
                <span class="status-label">å½“å‰ä»»åŠ¡:</span>
                <span id="currentTask" class="status-value">æ— </span>
            </div>
            <div class="status-item">
                <span class="status-label">æ—¥å¿—æ•°é‡:</span>
                <span id="logCount" class="status-value">0</span>
            </div>
            </div>
            
            <div class="control-buttons">
            <button id="startBtn" class="btn btn-success" onclick="startAutomation()">
                <span>â–¶</span> å¼€å§‹è‡ªåŠ¨åŒ–ä»»åŠ¡
            </button>
            <button id="stopBtn" class="btn btn-danger" onclick="stopAutomation()" disabled>
                <span>â– </span> åœæ­¢ä»»åŠ¡
            </button>
            <button class="btn btn-secondary" onclick="clearLogs()">
                <span>ğŸ—‘ï¸</span> æ¸…é™¤æ—¥å¿—
            </button>
            <button class="btn btn-secondary" onclick="testConnection()">
                <span>ğŸ”—</span> æµ‹è¯•è¿æ¥
            </button>
            </div>
        </div>
        
        <!-- ä»»åŠ¡æ—¥å¿— -->
        <div class="section">
            <div class="section-title">
            ä»»åŠ¡æ—¥å¿—
            <button class="toggle-btn" onclick="toggleLogs()" style="float: right;">
                æŠ˜å /å±•å¼€
            </button>
            </div>
            <div id="logsContainer" class="logs-container">
            <div id="logsContent">
                <div class="log-entry">
                <span class="log-time">ç³»ç»Ÿ</span>
                <span class="log-level log-info">INFO</span>
                <span class="log-message">è‡ªåŠ¨åŒ–æ§åˆ¶å°å·²å°±ç»ª</span>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>

<script>
    let isRunning = false
    let advancedVisible = false
    let logsVisible = true
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        updateStatus()
        setupEventListeners()
        
        // ç›‘å¬è‡ªåŠ¨åŒ–æ—¥å¿—
        window.automationAPI.onAutomationLog((log) => {
            addLog(log)
        })
        
        // ç›‘å¬è‡ªåŠ¨åŒ–ç»“æœ
        window.automationAPI.onAutomationResult((result) => {
            console.log('ä»»åŠ¡ç»“æœ:', result)
            if (result.success) {
            alert(`ä»»åŠ¡å®Œæˆï¼ä»»åŠ¡ID: ${result.taskId}`)
            } else {
            alert(`ä»»åŠ¡å¤±è´¥: ${result.error}`)
            }
            updateStatus()
        })
        
        // å®šæœŸæ›´æ–°çŠ¶æ€
        setInterval(updateStatus, 2000)
        })
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
        // URL è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document.getElementById('url').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
            startAutomation()
            }
        })
        
        // ä»»åŠ¡ç±»å‹å˜åŒ–
        document.getElementById('taskType').addEventListener('change', (e) => {
            updateTaskConfig(e.target.value)
        })
    }
    
    // æ›´æ–°ä»»åŠ¡é…ç½®
    function updateTaskConfig(type) {
        const urlInput = document.getElementById('url')
        
        switch(type) {
            case 'login':
            urlInput.value = 'http://localhost:80'
            break
            case 'data-entry':
            urlInput.value = 'http://localhost:80'
            break
            case 'simple':
            urlInput.value = 'http://localhost:80'
            break
            default:
            // ä¿æŒå½“å‰å€¼
        }
        }
        
        // å¼€å§‹è‡ªåŠ¨åŒ–
        async function startAutomation() {
        if (isRunning) {
            alert('å·²æœ‰ä»»åŠ¡æ­£åœ¨è¿è¡Œï¼Œè¯·å…ˆåœæ­¢å½“å‰ä»»åŠ¡')
            return
        }
        
        const config = {
            url: document.getElementById('url').value.trim(),
            headless: document.getElementById('headless').checked,
            screenshot: document.getElementById('screenshot').checked,
            tasks: getTaskConfig()
        }
        
        if (!config.url) {
            alert('è¯·è¾“å…¥ç›®æ ‡URL')
            return
        }
        
        try {
            const result = await window.automationAPI.startAutomation(config)
            
            if (result.success) {
            addLog({
                level: 'success',
                message: `ä»»åŠ¡å·²å¼€å§‹ï¼Œä»»åŠ¡ID: ${result.taskId}`
            })
            isRunning = true
            updateButtonStates()
            } else {
            addLog({
                level: 'error',
                message: `ä»»åŠ¡å¯åŠ¨å¤±è´¥: ${result.error}`
            })
            }
        } catch (error) {
            addLog({
            level: 'error',
            message: `å¯åŠ¨å¼‚å¸¸: ${error.message}`
            })
        }
    }
    
    // è·å–ä»»åŠ¡é…ç½®
    function getTaskConfig() {
        const taskType = document.getElementById('taskType').value
        
        switch(taskType) {
            case 'simple':
            return [
                {
                selector: 'input[type="text"]:first-of-type',
                description: 'å¡«å†™ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†',
                action: 'type',
                value: 'è‡ªåŠ¨åŒ–æµ‹è¯•',
                required: false,
                delay: 500
                },
                {
                selector: 'button[type="submit"], .el-button--primary',
                description: 'ç‚¹å‡»ä¸»è¦æŒ‰é’®',
                action: 'click',
                required: false,
                delay: 1000
                }
            ]
            
            case 'login':
            return [
                {
                selector: 'input[name="username"], input[type="text"]:first-of-type',
                description: 'è¾“å…¥ç”¨æˆ·å',
                action: 'type',
                value: 'admin',
                required: false,
                delay: 500
                },
                {
                selector: 'input[name="password"], input[type="password"]',
                description: 'è¾“å…¥å¯†ç ',
                action: 'type',
                value: 'admin123',
                required: false,
                delay: 500
                },
                {
                selector: 'input[name="validateCode"], input[placeholder*="éªŒè¯ç "]',
                description: 'éªŒè¯ç ',
                action: 'type',
                value: '2',
                required: false,
                delay: 500
                },
                {
                selector: 'button[type="button"], .login-btn',
                description: 'ç‚¹å‡»ç™»å½•æŒ‰é’®',
                action: 'click',
                required: false,
                delay: 2000
                }
            ]
            
            case 'custom':
            // è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡é…ç½®ç•Œé¢
            return [
                {
                selector: 'a:first-of-type',
                description: 'ç‚¹å‡»ç¬¬ä¸€ä¸ªé“¾æ¥',
                action: 'click',
                required: false,
                delay: 1000
                }
            ]
            
            default:
            return []
        }
    }
    
    // åœæ­¢è‡ªåŠ¨åŒ–
    async function stopAutomation() {
        if (!isRunning) {
            alert('æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡')
            return
        }
        
        try {
            const result = await window.automationAPI.stopAutomation()
            
            addLog({
            level: 'info',
            message: result.message
            })
            
            isRunning = false
            updateButtonStates()
        } catch (error) {
            addLog({
            level: 'error',
            message: `åœæ­¢å¤±è´¥: ${error.message}`
            })
        }
        }
        
        // æµ‹è¯•è¿æ¥
        async function testConnection() {
        const url = document.getElementById('url').value.trim()
        
        if (!url) {
            alert('è¯·è¾“å…¥è¦æµ‹è¯•çš„URL')
            return
        }
        
        addLog({
            level: 'info',
            message: `æ­£åœ¨æµ‹è¯•è¿æ¥: ${url}`
        })
        
        try {
            const response = await fetch(url, { method: 'HEAD' })
            
            if (response.ok) {
            addLog({
                level: 'success',
                message: 'è¿æ¥æµ‹è¯•æˆåŠŸ'
            })
            } else {
            addLog({
                level: 'warning',
                message: `è¿æ¥å¼‚å¸¸: ${response.status} ${response.statusText}`
            })
            }
        } catch (error) {
            addLog({
            level: 'error',
            message: `è¿æ¥å¤±è´¥: ${error.message}`
            })
        }
    }
    
    // æ¸…é™¤æ—¥å¿—
    async function clearLogs() {
        await window.automationAPI.clearAutomationLogs()
        document.getElementById('logsContent').innerHTML = `
            <div class="log-entry">
            <span class="log-time">ç³»ç»Ÿ</span>
            <span class="log-level log-info">INFO</span>
            <span class="log-message">æ—¥å¿—å·²æ¸…é™¤</span>
            </div>
        `
        updateLogCount()
        }
        
        // æ›´æ–°çŠ¶æ€
        async function updateStatus() {
        try {
            const status = await window.automationAPI.getAutomationStatus()
            
            // æ›´æ–°è¿è¡ŒçŠ¶æ€
            isRunning = status.isRunning
            document.getElementById('runningStatus').textContent = isRunning ? 'è¿è¡Œä¸­' : 'åœæ­¢'
            document.getElementById('runningStatus').className = `status-value ${isRunning ? 'status-running' : 'status-stopped'}`
            
            // æ›´æ–°æµè§ˆå™¨çŠ¶æ€
            document.getElementById('browserStatus').textContent = status.browserStatus
            
            // æ›´æ–°å½“å‰ä»»åŠ¡
            document.getElementById('currentTask').textContent = isRunning ? 'è‡ªåŠ¨åŒ–ä»»åŠ¡' : 'æ— '
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonStates()
            
            // æ›´æ–°æ—¥å¿—è®¡æ•°
            updateLogCount()
            
        } catch (error) {
            console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error)
        }
    }
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    function updateButtonStates() {
        const startBtn = document.getElementById('startBtn')
        const stopBtn = document.getElementById('stopBtn')
        
        startBtn.disabled = isRunning
        stopBtn.disabled = !isRunning
        }
        
        // æ›´æ–°æ—¥å¿—è®¡æ•°
        function updateLogCount() {
        const logs = document.getElementById('logsContent').getElementsByClassName('log-entry')
        document.getElementById('logCount').textContent = logs.length
        }
        
        // æ·»åŠ æ—¥å¿—
        function addLog(log) {
        const logsContent = document.getElementById('logsContent')
        const logEntry = document.createElement('div')
        logEntry.className = 'log-entry'
        
        const time = log.timestamp ? new Date(log.timestamp).toLocaleTimeString() : new Date().toLocaleTimeString()
        const level = log.level || 'info'
        const message = log.message || ''
        
        logEntry.innerHTML = `
            <span class="log-time">${time}</span>
            <span class="log-level log-${level}">${level.toUpperCase()}</span>
            <span class="log-message">${message}</span>
        `
        
        logsContent.appendChild(logEntry)
        
        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        const logsContainer = document.getElementById('logsContainer')
        logsContainer.scrollTop = logsContainer.scrollHeight
        
        // æ›´æ–°è®¡æ•°
        updateLogCount()
    }
    
    // åˆ‡æ¢é«˜çº§é…ç½®
    function toggleAdvanced() {
        advancedVisible = !advancedVisible
        const advancedConfig = document.getElementById('advancedConfig')
        const toggleBtn = document.querySelector('.toggle-btn')
        
        if (advancedVisible) {
            advancedConfig.style.display = 'block'
            toggleBtn.textContent = 'éšè—é«˜çº§é…ç½®'
        } else {
            advancedConfig.style.display = 'none'
            toggleBtn.textContent = 'æ˜¾ç¤ºé«˜çº§é…ç½®'
        }
    }
    
    // åˆ‡æ¢æ—¥å¿—æ˜¾ç¤º
    function toggleLogs() {
        logsVisible = !logsVisible
        const logsContainer = document.getElementById('logsContainer')
        const toggleBtn = document.querySelector('.toggle-btn')
        
        if (logsVisible) {
            logsContainer.style.display = 'block'
            toggleBtn.textContent = 'æŠ˜å '
        } else {
            logsContainer.style.display = 'none'
            toggleBtn.textContent = 'å±•å¼€'
        }
        }
    </script>
    </body>
</html>