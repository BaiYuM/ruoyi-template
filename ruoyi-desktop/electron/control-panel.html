<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruoyi Desktop æ§åˆ¶é¢æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .card-title {
            font-size: 1.5em;
            color: #2d3748;
            font-weight: 600;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .status-running {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-stopped {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-pending {
            background: #feebc8;
            color: #744210;
        }

        .task-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            background: #f7fafc;
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .task-item:hover {
            background: #edf2f7;
        }

        .task-info h4 {
            color: #2d3748;
            margin-bottom: 5px;
        }

        .task-info p {
            color: #718096;
            font-size: 0.9em;
        }

        .task-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: opacity 0.3s ease;
        }

        .task-actions button:hover {
            opacity: 0.9;
        }

        .btn-start {
            background: #48bb78;
            color: white;
        }

        .btn-stop {
            background: #f56565;
            color: white;
        }

        .btn-delete {
            background: #a0aec0;
            color: white;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .control-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: #4c51bf;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .control-btn:hover {
            background: #434190;
            transform: scale(1.05);
        }

        .control-btn i {
            font-size: 1.2em;
        }

        .log-panel {
            background: rgba(0, 0, 0, 0.85);
            color: #00ff9d;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .log-time {
            color: #63b3ed;
        }

        .log-level-info {
            color: #68d391;
        }

        .log-level-error {
            color: #fc8181;
        }

        .log-level-warn {
            color: #f6ad55;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4c51bf;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4c51bf, #667eea);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-desktop"></i> Ruoyi Desktop æ§åˆ¶é¢æ¿</h1>
            <p>è‡ªåŠ¨åŒ–ä»»åŠ¡ç®¡ç†ä¸æµè§ˆå™¨æ§åˆ¶ä¸­å¿ƒ</p>
        </div>

        <div class="control-panel">
            <button class="control-btn" onclick="createNewWindow()">
                <i class="fas fa-plus"></i> æ–°å»ºçª—å£
            </button>
            <button class="control-btn" onclick="startAutomation()">
                <i class="fas fa-play"></i> å¼€å§‹è‡ªåŠ¨åŒ–
            </button>
            <button class="control-btn" onclick="stopAllTasks()">
                <i class="fas fa-stop"></i> åœæ­¢æ‰€æœ‰ä»»åŠ¡
            </button>
            <button class="control-btn" onclick="takeScreenshot()">
                <i class="fas fa-camera"></i> æˆªå›¾
            </button>
            <button class="control-btn" onclick="showLogs()">
                <i class="fas fa-clipboard-list"></i> æŸ¥çœ‹æ—¥å¿—
            </button>
        </div>

        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ä»»åŠ¡ç®¡ç†</div>
                    <span class="status-badge status-running" id="systemStatus">è¿è¡Œä¸­</span>
                </div>
                <div class="task-list" id="taskList">
                    <!-- ä»»åŠ¡åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalTasks">0</div>
                        <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="runningTasks">0</div>
                        <div class="stat-label">è¿è¡Œä¸­</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completedTasks">0</div>
                        <div class="stat-label">å·²å®Œæˆ</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">æµè§ˆå™¨ç®¡ç†</div>
                    <span class="status-badge status-running" id="browserStatus">å°±ç»ª</span>
                </div>
                <div id="browserList">
                    <!-- æµè§ˆå™¨åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div style="margin-top: 20px;">
                    <button class="control-btn" onclick="createBrowser()" style="width: 100%;">
                        <i class="fas fa-window-restore"></i> åˆ›å»ºæ–°æµè§ˆå™¨å®ä¾‹
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">ç³»ç»Ÿç›‘æ§</div>
                    <span class="status-badge status-running">æ­£å¸¸</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="cpuUsage">--</div>
                        <div class="stat-label">CPU ä½¿ç”¨ç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="memoryUsage">--</div>
                        <div class="stat-label">å†…å­˜ä½¿ç”¨</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="activeWindows">0</div>
                        <div class="stat-label">æ´»åŠ¨çª—å£</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <div>ç³»ç»Ÿè´Ÿè½½</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="systemLoad" style="width: 30%;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card" style="margin-bottom: 30px;">
            <div class="card-header">
            <div class="card-title">æµè§ˆå™¨è¿æ¥</div>
            <span class="status-badge status-stopped" id="connectionStatus">æœªè¿æ¥</span>
        </div>
        
        <div style="margin-bottom: 15px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div>
                <label style="display: block; margin-bottom: 5px; color: #4a5568;">è°ƒè¯•ç«¯å£:</label>
                <input type="number" id="debugPort" value="9222" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; color: #4a5568;">WebSocket URL:</label>
                <input type="text" id="wsUrl" placeholder="ws://127.0.0.1:9222/devtools/..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
            </div>
            </div>
        </div>
        
        <div class="control-panel">
            <button class="control-btn" onclick="scanExistingBrowsers()">
            <i class="fas fa-search"></i> æ‰«ææµè§ˆå™¨
            </button>
            <button class="control-btn" onclick="connectToExistingBrowser()">
            <i class="fas fa-plug"></i> è¿æ¥æµè§ˆå™¨
            </button>
            <button class="control-btn" onclick="testConnection()">
            <i class="fas fa-vial"></i> æµ‹è¯•è¿æ¥
            </button>
            <button class="control-btn" onclick="launchDebugChrome()">
            <i class="fas fa-rocket"></i> å¯åŠ¨è°ƒè¯•Chrome
            </button>
        </div>
        
        <div id="browserList" style="margin-top: 15px; max-height: 200px; overflow-y: auto;">
            <!-- æµè§ˆå™¨åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
        </div>
        <div class="card">
            <div class="card-header">
                <div class="card-title">å®æ—¶æ—¥å¿—</div>
                <button class="control-btn" onclick="clearLogs()" style="padding: 5px 15px; font-size: 0.9em;">
                    <i class="fas fa-trash"></i> æ¸…ç©ºæ—¥å¿—
                </button>
            </div>
            <div class="log-panel" id="logPanel">
                <div class="log-entry">
                    <span class="log-time">[12:00:00]</span>
                    <span class="log-level-info">[INFO]</span> ç³»ç»Ÿå¯åŠ¨å®Œæˆ
                </div>
            </div>
        </div>
    </div>


    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadTasks();
            loadBrowsers();
            startMonitoring();
            setupEventListeners();
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            window.electronAPI.onTaskUpdate((data) => {
                addLog('info', `ä»»åŠ¡æ›´æ–°: ${JSON.stringify(data)}`);
                loadTasks();
            });

            window.electronAPI.onWindowEvent((data) => {
                addLog('info', `çª—å£äº‹ä»¶: ${JSON.stringify(data)}`);
                updateWindowStats();
            });
        }

        // åŠ è½½ä»»åŠ¡åˆ—è¡¨
        async function loadTasks() {
            try {
                const tasks = await window.electronAPI.listTasks();
                const taskList = document.getElementById('taskList');
                const totalTasks = document.getElementById('totalTasks');
                const runningTasks = document.getElementById('runningTasks');
                const completedTasks = document.getElementById('completedTasks');
                
                taskList.innerHTML = '';
                
                let runningCount = 0;
                let completedCount = 0;
                
                tasks.forEach(task => {
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';
                    
                    taskItem.innerHTML = `
                        <div class="task-info">
                            <h4>${task.name}</h4>
                            <p>ID: ${task.id} | ç±»å‹: ${task.type}</p>
                            <p>è¿›åº¦: ${task.progress}%</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${task.progress}%"></div>
                            </div>
                        </div>
                        <div class="task-actions">
                            ${task.status === 'running' ? 
                                `<button class="btn-stop" onclick="stopTask('${task.id}')">åœæ­¢</button>` :
                                `<button class="btn-start" onclick="startTask('${task.id}')">å¼€å§‹</button>`
                            }
                            <button class="btn-delete" onclick="deleteTask('${task.id}')">åˆ é™¤</button>
                        </div>
                    `;
                    
                    taskList.appendChild(taskItem);
                    
                    if (task.status === 'running') runningCount++;
                    if (task.status === 'completed') completedCount++;
                });
                
                totalTasks.textContent = tasks.length;
                runningTasks.textContent = runningCount;
                completedTasks.textContent = completedCount;
                
            } catch (error) {
                addLog('error', `åŠ è½½ä»»åŠ¡å¤±è´¥: ${error.message}`);
            }
        }

        // åŠ è½½æµè§ˆå™¨åˆ—è¡¨
        async function loadBrowsers() {
            try {
                // è¿™é‡Œéœ€è¦å®ç°è·å–æµè§ˆå™¨åˆ—è¡¨çš„API
                addLog('info', 'åŠ è½½æµè§ˆå™¨åˆ—è¡¨...');
            } catch (error) {
                addLog('error', `åŠ è½½æµè§ˆå™¨åˆ—è¡¨å¤±è´¥: ${error.message}`);
            }
        }

        // å¼€å§‹ç›‘æ§
        function startMonitoring() {
            setInterval(async () => {
                updateSystemStats();
                updateWindowStats();
            }, 5000);
        }

        // æ›´æ–°ç³»ç»ŸçŠ¶æ€
        async function updateSystemStats() {
            // æ¨¡æ‹Ÿç³»ç»ŸçŠ¶æ€æ›´æ–°
            document.getElementById('cpuUsage').textContent = 
                Math.floor(Math.random() * 30 + 10) + '%';
            
            document.getElementById('memoryUsage').textContent = 
                Math.floor(Math.random() * 4 + 2) + ' GB';
            
            const systemLoad = document.getElementById('systemLoad');
            const load = Math.floor(Math.random() * 100);
            systemLoad.style.width = `${load}%`;
        }

        // æ›´æ–°çª—å£ç»Ÿè®¡
        async function updateWindowStats() {
            // è¿™é‡Œéœ€è¦å®ç°è·å–çª—å£æ•°é‡çš„API
            const activeWindows = document.getElementById('activeWindows');
            activeWindows.textContent = Math.floor(Math.random() * 5 + 1);
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(level, message) {
            const logPanel = document.getElementById('logPanel');
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-time">[${timeString}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span> ${message}
            `;
            
            logPanel.appendChild(logEntry);
            logPanel.scrollTop = logPanel.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ•°é‡
            if (logPanel.children.length > 100) {
                logPanel.removeChild(logPanel.firstChild);
            }
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            const logPanel = document.getElementById('logPanel');
            logPanel.innerHTML = '';
            addLog('info', 'æ—¥å¿—å·²æ¸…ç©º');
        }

        // æ§åˆ¶å‡½æ•°
        async function createNewWindow() {
            try {
                const windowId = await window.electronAPI.createWindow({
                    url: 'https://www.baidu.com',
                    width: 1024,
                    height: 768
                });
                addLog('info', `åˆ›å»ºæ–°çª—å£: ${windowId}`);
            } catch (error) {
                addLog('error', `åˆ›å»ºçª—å£å¤±è´¥: ${error.message}`);
            }
        }

        async function startAutomation() {
            try {
                const script = [
                    {
                        action: 'navigate',
                        url: 'https://www.baidu.com'
                    },
                    {
                        action: 'type',
                        selector: '#kw',
                        text: 'è‡ªåŠ¨åŒ–æµ‹è¯•'
                    },
                    {
                        action: 'click',
                        selector: '#su'
                    },
                    {
                        action: 'wait',
                        timeout: 2000
                    },
                    {
                        action: 'screenshot',
                        options: { fullPage: true }
                    }
                ];
                
                await window.electronAPI.executeAutomation(JSON.stringify(script));
                addLog('info', 'è‡ªåŠ¨åŒ–ä»»åŠ¡å·²å¼€å§‹');
            } catch (error) {
                addLog('error', `å¯åŠ¨è‡ªåŠ¨åŒ–å¤±è´¥: ${error.message}`);
            }
        }

        async function stopAllTasks() {
            try {
                const tasks = await window.electronAPI.listTasks();
                for (const task of tasks) {
                    if (task.status === 'running') {
                        await window.electronAPI.stopTask(task.id);
                    }
                }
                addLog('info', 'æ‰€æœ‰ä»»åŠ¡å·²åœæ­¢');
                loadTasks();
            } catch (error) {
                addLog('error', `åœæ­¢ä»»åŠ¡å¤±è´¥: ${error.message}`);
            }
        }

        async function takeScreenshot() {
            try {
                addLog('info', 'æ­£åœ¨æˆªå›¾...');
                // è¿™é‡Œéœ€è¦å®ç°æˆªå›¾åŠŸèƒ½
                setTimeout(() => {
                    addLog('info', 'æˆªå›¾å·²ä¿å­˜');
                }, 1000);
            } catch (error) {
                addLog('error', `æˆªå›¾å¤±è´¥: ${error.message}`);
            }
        }

        function showLogs() {
            addLog('info', 'æ˜¾ç¤ºæ—¥å¿—é¢æ¿');
        }

        async function startTask(taskId) {
            try {
                await window.electronAPI.startTask({ id: taskId });
                addLog('info', `ä»»åŠ¡ ${taskId} å·²å¼€å§‹`);
                loadTasks();
            } catch (error) {
                addLog('error', `å¯åŠ¨ä»»åŠ¡å¤±è´¥: ${error.message}`);
            }
        }

        async function stopTask(taskId) {
            try {
                await window.electronAPI.stopTask(taskId);
                addLog('info', `ä»»åŠ¡ ${taskId} å·²åœæ­¢`);
                loadTasks();
            } catch (error) {
                addLog('error', `åœæ­¢ä»»åŠ¡å¤±è´¥: ${error.message}`);
            }
        }

        async function deleteTask(taskId) {
            try {
                addLog('info', `åˆ é™¤ä»»åŠ¡: ${taskId}`);
                // è¿™é‡Œéœ€è¦å®ç°åˆ é™¤ä»»åŠ¡çš„API
                loadTasks();
            } catch (error) {
                addLog('error', `åˆ é™¤ä»»åŠ¡å¤±è´¥: ${error.message}`);
            }
        }

        async function createBrowser() {
            try {
                addLog('info', 'æ­£åœ¨åˆ›å»ºæµè§ˆå™¨å®ä¾‹...');
                // è¿™é‡Œéœ€è¦å®ç°åˆ›å»ºæµè§ˆå™¨çš„API
            } catch (error) {
                addLog('error', `åˆ›å»ºæµè§ˆå™¨å¤±è´¥: ${error.message}`);
            }
        }

        // æŠ–éŸ³è‡ªåŠ¨åŒ–å‡½æ•°
async function startDouyinAutomation() {
    try {
        addLog('info', 'å¼€å§‹æŠ–éŸ³è‡ªåŠ¨åŒ–ä»»åŠ¡...');
        
        const script = {
            type: 'douyin',
            chromePath: 'D:\\Google\\Chrome\\Application\\chrome.exe',
            actions: [
                {
                    action: 'navigate',
                    url: 'https://www.douyin.com',
                    description: 'æ‰“å¼€æŠ–éŸ³é¦–é¡µ'
                },
                {
                    action: 'wait',
                    timeout: 5000,
                    description: 'ç­‰å¾…é¡µé¢åŠ è½½'
                },
                {
                    action: 'evaluate',
                    script: 'window.scrollBy(0, window.innerHeight * 2)',
                    description: 'æ»šåŠ¨é¡µé¢åŠ è½½è§†é¢‘'
                },
                {
                    action: 'wait',
                    timeout: 2000,
                    description: 'ç­‰å¾…è§†é¢‘åŠ è½½'
                },
                {
                    action: 'click',
                    selector: '[data-e2e="feed-video"]:first-child',
                    description: 'ç‚¹å‡»ç¬¬ä¸€ä¸ªè§†é¢‘'
                },
                {
                    action: 'wait',
                    timeout: 3000,
                    description: 'ç­‰å¾…è§†é¢‘æ’­æ”¾'
                },
                {
                    action: 'click',
                    selector: '[data-e2e="browse-like"]',
                    description: 'ç‚¹èµè§†é¢‘'
                },
                {
                    action: 'wait',
                    timeout: 1000,
                    description: 'ç­‰å¾…æ“ä½œå®Œæˆ'
                },
                {
                    action: 'screenshot',
                    options: {
                        path: './screenshots/douyin_{{timestamp}}.png'
                    },
                    description: 'æˆªå›¾ä¿å­˜'
                }
            ]
        };
        
        const result = await window.electronAPI.executeAutomation(JSON.stringify(script));
        
        if (result.success) {
            addLog('success', `æŠ–éŸ³è‡ªåŠ¨åŒ–ä»»åŠ¡å¼€å§‹ï¼ŒID: ${result.automationId}`);
            
            // ç›‘å¬è‡ªåŠ¨åŒ–çŠ¶æ€
            window.electronAPI.onAutomationStatus((data) => {
                if (data.automationId === result.automationId) {
                    addLog('info', `è‡ªåŠ¨åŒ–çŠ¶æ€: ${data.status}`);
                }
            });
        } else {
            addLog('error', `è‡ªåŠ¨åŒ–ä»»åŠ¡å¤±è´¥: ${result.error}`);
        }
    } catch (error) {
        addLog('error', `å¯åŠ¨æŠ–éŸ³è‡ªåŠ¨åŒ–å¤±è´¥: ${error.message}`);
    }
}

// é«˜çº§æŠ–éŸ³ä»»åŠ¡
async function startAdvancedDouyinTask() {
    try {
        addLog('info', 'å¼€å§‹é«˜çº§æŠ–éŸ³ä»»åŠ¡...');
        
        const taskConfig = {
            name: 'é«˜çº§æŠ–éŸ³äº’åŠ¨ä»»åŠ¡',
            type: 'douyin',
            config: {
                chromePath: 'D:\\Google\\Chrome\\Application\\chrome.exe',
                headless: false,
                userDataDir: './chrome_profile', // ä½¿ç”¨å·²ç™»å½•çš„Chromeé…ç½®
                actions: ['scroll', 'like', 'comment', 'follow'],
                scrollCount: 5,
                likeCount: 3,
                commentText: 'è¿™ä¸ªè§†é¢‘çœŸä¸é”™ï¼',
                screenshot: true,
                randomDelay: true,
                maxVideos: 10
            }
        };
        
        const taskId = await window.electronAPI.startTask(taskConfig);
        addLog('success', `é«˜çº§æŠ–éŸ³ä»»åŠ¡å·²å¼€å§‹ï¼Œä»»åŠ¡ID: ${taskId}`);
    } catch (error) {
        addLog('error', `å¯åŠ¨é«˜çº§æŠ–éŸ³ä»»åŠ¡å¤±è´¥: ${error.message}`);
    }
}

// æŠ–éŸ³è§†é¢‘ç›‘æ§
async function monitorDouyinVideos() {
    try {
        addLog('info', 'å¼€å§‹æŠ–éŸ³è§†é¢‘ç›‘æ§...');
        
        const monitorConfig = {
            name: 'æŠ–éŸ³è§†é¢‘ç›‘æ§',
            type: 'monitoring',
            schedule: {
                type: 'interval',
                interval: 600000, // æ¯10åˆ†é’Ÿ
                startTime: '08:00',
                endTime: '22:00'
            },
            config: {
                chromePath: 'D:\\Google\\Chrome\\Application\\chrome.exe',
                targetUrl: 'https://www.douyin.com',
                keywords: ['çƒ­é—¨', 'æ¨è', 'æç¬‘'],
                checkInterval: 300000, // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
                notifyOnNew: true,
                saveScreenshots: true
            }
        };
        
        const taskId = await window.electronAPI.startTask(monitorConfig);
        addLog('success', `æŠ–éŸ³ç›‘æ§ä»»åŠ¡å·²å¼€å§‹ï¼Œä»»åŠ¡ID: ${taskId}`);
    } catch (error) {
        addLog('error', `å¯åŠ¨ç›‘æ§ä»»åŠ¡å¤±è´¥: ${error.message}`);
    }
}

// åœ¨æ§åˆ¶é¢æ¿ä¸­æ·»åŠ æŠ–éŸ³ä¸“ç”¨æŒ‰é’®
function addDouyinControls() {
    const controlPanel = document.querySelector('.control-panel');
    
    const douyinButtons = `
        <button class="control-btn" onclick="startDouyinAutomation()" style="background: linear-gradient(135deg, #FF0050, #FF6B9D);">
            <i class="fab fa-tiktok"></i> æŠ–éŸ³è‡ªåŠ¨åŒ–
        </button>
        <button class="control-btn" onclick="startAdvancedDouyinTask()" style="background: linear-gradient(135deg, #25F4EE, #FE2C55);">
            <i class="fas fa-robot"></i> é«˜çº§æŠ–éŸ³ä»»åŠ¡
        </button>
        <button class="control-btn" onclick="monitorDouyinVideos()" style="background: linear-gradient(135deg, #000000, #333333);">
            <i class="fas fa-eye"></i> æŠ–éŸ³ç›‘æ§
        </button>
    `;
    
    controlPanel.innerHTML += douyinButtons;
}

// åœ¨é¡µé¢åŠ è½½æ—¶æ·»åŠ æŠ–éŸ³æ§åˆ¶æŒ‰é’®
document.addEventListener('DOMContentLoaded', () => {
    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
    addDouyinControls();
});
// æ‰«æç°æœ‰æµè§ˆå™¨
async function scanExistingBrowsers() {
  try {
    addLog('info', 'æ­£åœ¨æ‰«ææµè§ˆå™¨...');
    
    const browsers = await window.electronAPI.scanBrowsers();
    
    if (!browsers || browsers.length === 0) {
      addLog('warning', 'æœªæ‰¾åˆ°å¯è¿æ¥çš„æµè§ˆå™¨');
      return;
    }
    
    const browserList = document.getElementById('browserList');
    browserList.innerHTML = '';
    
    browsers.forEach((browser, index) => {
      const browserItem = document.createElement('div');
      browserItem.className = 'browser-item';
      browserItem.style.cssText = `
        padding: 10px;
        margin-bottom: 8px;
        background: #f7fafc;
        border-radius: 8px;
        border-left: 4px solid #4299e1;
      `;
      
      browserItem.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong>æµè§ˆå™¨ ${index + 1}</strong>
            <div style="font-size: 0.9em; color: #718096;">
              ç«¯å£: ${browser.port} | é¡µé¢: ${browser.pages?.length || 0}
            </div>
          </div>
          <button onclick="connectToBrowser('${browser.webSocketDebuggerUrl}')" style="
            background: #48bb78;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
          ">
            è¿æ¥
          </button>
        </div>
        ${browser.pages && browser.pages.length > 0 ? `
          <div style="margin-top: 8px; font-size: 0.85em; color: #4a5568;">
            ${browser.pages.map(p => 
              `<div>ğŸ“„ ${p.title || 'æ— æ ‡é¢˜'} - ${p.url}</div>`
            ).join('')}
          </div>
        ` : ''}
      `;
      
      browserList.appendChild(browserItem);
    });
    
    addLog('success', `æ‰¾åˆ° ${browsers.length} ä¸ªæµè§ˆå™¨`);
  } catch (error) {
    addLog('error', `æ‰«ææµè§ˆå™¨å¤±è´¥: ${error.message}`);
  }
}


// è¿æ¥åˆ°æŒ‡å®šç«¯å£
async function connectToBrowser(webSocketDebuggerUrl) {
  try {
    addLog('info', 'æ­£åœ¨è¿æ¥æµè§ˆå™¨...');
    
    const result = await window.electronAPI.connectToBrowser({
      webSocketDebuggerUrl: webSocketDebuggerUrl
    });
    
    if (result.success) {
      addLog('success', `è¿æ¥æˆåŠŸ! è¿æ¥ID: ${result.connectionId}`);
      document.getElementById('connectionStatus').textContent = 'å·²è¿æ¥';
      document.getElementById('connectionStatus').className = 'status-badge status-running';
    } else {
      addLog('error', `è¿æ¥å¤±è´¥: ${result.error}`);
    }
  } catch (error) {
    addLog('error', `è¿æ¥å¤±è´¥: ${error.message}`);
  }
}

// è¿æ¥åˆ°ç°æœ‰æµè§ˆå™¨
async function connectToExistingBrowser() {
  const portInput = document.getElementById('debugPort');
  const port = parseInt(portInput.value) || 9222;
  
  await connectToPort(port);
}

// å¯åŠ¨è°ƒè¯• Chrome
async function launchDebugChrome() {
  try {
    addLog('info', 'æ­£åœ¨å¯åŠ¨è°ƒè¯•ç‰ˆ Chrome...');
    
    const result = await window.electronAPI.launchDebugChrome({
      chromePath: 'D:\\Google\\Chrome\\Application\\chrome.exe',
      url: 'https://www.douyin.com',
      port: 9222
    });
    
    if (result.success) {
      addLog('success', `Chrome å·²å¯åŠ¨ï¼ŒPID: ${result.pid}, ç«¯å£: ${result.port}`);
      
      // ç­‰å¾… 3 ç§’åè‡ªåŠ¨è¿æ¥
      setTimeout(async () => {
        addLog('info', 'å°è¯•è‡ªåŠ¨è¿æ¥...');
        await connectToPort(result.port);
      }, 3000);
    } else {
      addLog('error', `å¯åŠ¨å¤±è´¥: ${result.error}`);
    }
  } catch (error) {
    addLog('error', `å¯åŠ¨å¤±è´¥: ${error.message}`);
  }
}

// æ›´æ–°è¿æ¥çŠ¶æ€
function updateConnectionStatus(connectionId) {
  setInterval(async () => {
    try {
      // è¿™é‡Œå¯ä»¥æ·»åŠ å¿ƒè·³æ£€æµ‹
      const browsers = await window.electronAPI.scanBrowsers();
      const statusElement = document.getElementById('connectionStatus');
      
      if (browsers.length > 0) {
        statusElement.textContent = 'å·²è¿æ¥';
        statusElement.className = 'status-badge status-running';
      } else {
        statusElement.textContent = 'æœªè¿æ¥';
        statusElement.className = 'status-badge status-stopped';
      }
    } catch (error) {
      console.error('æ›´æ–°è¿æ¥çŠ¶æ€å¤±è´¥:', error);
    }
  }, 5000);
}

// æŠ–éŸ³è‡ªåŠ¨åŒ–ï¼ˆä½¿ç”¨ç°æœ‰æµè§ˆå™¨ï¼‰
async function douyinWithExistingBrowser() {
  try {
    addLog('info', 'å¼€å§‹æŠ–éŸ³è‡ªåŠ¨åŒ–ï¼ˆä½¿ç”¨ç°æœ‰æµè§ˆå™¨ï¼‰...');
    
    const portInput = document.getElementById('debugPort');
    const port = parseInt(portInput.value) || 9222;
    
    const result = await window.electronAPI.executeDouyinWithExisting({
      port: port,
      actions: ['scroll', 'like', 'comment'],
      scrollCount: 5,
      likeCount: 3,
      commentText: 'èµï¼ğŸ‘'
    });
    
    if (result.success) {
      addLog('success', `æŠ–éŸ³è‡ªåŠ¨åŒ–å®Œæˆ: ${result.message}`);
      
      // æˆªå›¾
      setTimeout(async () => {
        try {
          addLog('info', 'æ­£åœ¨æˆªå›¾...');
          // è¿™é‡Œå¯ä»¥æ·»åŠ æˆªå›¾åŠŸèƒ½
        } catch (error) {
          addLog('error', `æˆªå›¾å¤±è´¥: ${error.message}`);
        }
      }, 2000);
    } else {
      addLog('error', `æŠ–éŸ³è‡ªåŠ¨åŒ–å¤±è´¥: ${result.error}`);
    }
  } catch (error) {
    addLog('error', `æŠ–éŸ³è‡ªåŠ¨åŒ–å¤±è´¥: ${error.message}`);
  }
}

// åœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰«ææµè§ˆå™¨
document.addEventListener('DOMContentLoaded', () => {
  // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
  
  // è‡ªåŠ¨æ‰«ææµè§ˆå™¨
  setTimeout(() => {
    scanExistingBrowsers();
  }, 1000);
});
// ä¿®æ”¹ startAutomation å‡½æ•°ï¼Œæ·»åŠ æŠ–éŸ³é€‰é¡¹
async function startAutomation() {
    try {
        // è®©ç”¨æˆ·é€‰æ‹©è‡ªåŠ¨åŒ–ç±»å‹
        const automationTypes = [
            { name: 'æŠ–éŸ³è‡ªåŠ¨åŒ–', value: 'douyin' },
            { name: 'ç™¾åº¦æœç´¢', value: 'baidu' },
            { name: 'è‡ªå®šä¹‰è„šæœ¬', value: 'custom' }
        ];
        
        // è¿™é‡Œå¯ä»¥åˆ›å»ºä¸€ä¸ªé€‰æ‹©å¯¹è¯æ¡†
        // æš‚æ—¶é»˜è®¤æ‰§è¡ŒæŠ–éŸ³è‡ªåŠ¨åŒ–
        await startDouyinAutomation();
    } catch (error) {
        addLog('error', `å¯åŠ¨è‡ªåŠ¨åŒ–å¤±è´¥: ${error.message}`);
    }
}

// æµ‹è¯•è¿æ¥
async function testConnection() {
    const portInput = document.getElementById('debugPort');
    const port = parseInt(portInput.value) || 9222;
    
    try {
        addLog('info', `æµ‹è¯•ç«¯å£ ${port} è¿æ¥...`);
        
        // ç›´æ¥ä½¿ç”¨ fetch æµ‹è¯•
        const response = await fetch(`http://localhost:${port}/json/version`);
        if (response.ok) {
            const data = await response.json();
            addLog('success', `è¿æ¥æˆåŠŸï¼\næµè§ˆå™¨: ${data.Browser}\nWebSocket: ${data.webSocketDebuggerUrl}`);
            
            // è·å–é¡µé¢åˆ—è¡¨
            const pagesResponse = await fetch(`http://localhost:${port}/json/list`);
            const pages = await pagesResponse.json();
            addLog('info', `å‘ç° ${pages.length} ä¸ªé¡µé¢:`);
            
            pages.forEach((page, i) => {
                addLog('info', `${i + 1}. ${page.title || 'æ— æ ‡é¢˜'} - ${page.url}`);
            });
        } else {
            addLog('error', `è¿æ¥å¤±è´¥: ${response.status} ${response.statusText}`);
        }
    } catch (error) {
        addLog('error', `æµ‹è¯•è¿æ¥å¤±è´¥: ${error.message}`);
    }
}

// ä¿®æ”¹è¿æ¥å‡½æ•°
async function connectToExistingBrowser() {
    const portInput = document.getElementById('debugPort');
    const wsUrlInput = document.getElementById('wsUrl');
    const port = parseInt(portInput.value) || 9222;
    const wsUrl = wsUrlInput.value;
    
    try {
        addLog('info', 'æ­£åœ¨è¿æ¥æµè§ˆå™¨...');
        
        const options = {};
        if (wsUrl) {
            options.webSocketDebuggerUrl = wsUrl;
        } else {
            options.port = port;
        }
        
        const result = await window.electronAPI.connectToBrowser(options);
        
        if (result.success) {
            addLog('success', `è¿æ¥æˆåŠŸ! è¿æ¥ID: ${result.connectionId}`);
            document.getElementById('connectionStatus').textContent = 'å·²è¿æ¥';
            document.getElementById('connectionStatus').className = 'status-badge status-running';
            
            // è‡ªåŠ¨æ›´æ–° WebSocket URL
            if (result.browserWSEndpoint) {
                wsUrlInput.value = result.browserWSEndpoint;
            }
        } else {
            addLog('error', `è¿æ¥å¤±è´¥: ${result.error}`);
        }
    } catch (error) {
        addLog('error', `è¿æ¥å¤±è´¥: ${error.message}`);
    }
}

// æ·»åŠ æ ·å¼æ›´æ–°æŠ–éŸ³æŒ‰é’®
const style = document.createElement('style');
style.textContent = `
    .douyin-btn {
        background: linear-gradient(135deg, #FF0050, #25F4EE) !important;
        color: white !important;
    }
    
    .douyin-btn:hover {
        background: linear-gradient(135deg, #FF6B9D, #FE2C55) !important;
        transform: scale(1.05) !important;
    }
    
    .douyin-stats {
        background: rgba(255, 0, 80, 0.1) !important;
        border: 1px solid #FF0050 !important;
    }
`;
document.head.appendChild(style);

        // å¯¼å‡ºå‡½æ•°åˆ°å…¨å±€
        window.createNewWindow = createNewWindow;
        window.startAutomation = startAutomation;
        window.stopAllTasks = stopAllTasks;
        window.takeScreenshot = takeScreenshot;
        window.showLogs = showLogs;
        window.clearLogs = clearLogs;
        window.startTask = startTask;
        window.stopTask = stopTask;
        window.deleteTask = deleteTask;
        window.createBrowser = createBrowser;
    </script>
</body>
</html>